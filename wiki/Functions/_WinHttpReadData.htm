<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
    <head>
        <title>_WinHttpReadData</title>        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link href="../CSS/Default1.css" rel="stylesheet" type="text/css">
    </head>

    <body>

<!--Description Section-->
        <h1 class="small">Function Reference</h1>
        <h1>_WinHttpReadData</h1>
        <hr style="height:0px">
        <p>Reads data from a handle opened by the _WinHttpOpenRequest() function.<br></p>

<!--Syntax Section-->
        <h2>Syntax</h2>
        <p>        <p class="codeheader">
        #include "WinHttp.au3"<br>
        _WinHttpReadData($hRequest [, $iMode = Default [, $iNumberOfBytesToRead = Default ]])<br>
        </p>

<!--Parameters Section-->
        <h2>Parameters</h2>
        <table class="paramstable" summary="function parameters">
            <tr>
                <td class="leftpane">$hRequest</td>
                <td class="rightpane">Valid handle returned from a previous call to _WinHttpOpenRequest().</td>
            </tr>
            <tr>
                <td class="leftpane">$iMode</td>
                <td class="rightpane"><b>[optional]</b> Integer representing reading mode. Default is 0 (charset is decoded as it is ANSI).</td>
            </tr>
            <tr>
                <td class="leftpane">$iNumberOfBytesToRead</td>
                <td class="rightpane"><b>[optional]</b> The number of bytes to read. Default is 8192 bytes.</td>
            </tr>
        </table>

<!--Return Value Section-->
        <h2>Return Value</h2>
        <p>Success - Returns data read.<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- @extended receives the number of bytes read.</p>

<!--Remarks Section-->
        <h2>Remarks</h2>
        <p>$iMode can have these values:
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0 - ANSI
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1 - UTF8
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2 - Binary</p>
        <br>

<!--Related Section-->
        <h2>Related</h2><a href="_WinHttpOpenRequest.htm">_WinHttpOpenRequest</a>, <a href="_WinHttpWriteData.htm">_WinHttpWriteData</a>
        <br>

<!--Link Section-->
        <h2>See Also</h2>
        <a title="External link" href="http://msdn.microsoft.com/en-us/library/aa384104(VS.85).aspx">MSDN</a>

        <br>

<!--Example Section-->
        <h2>Example</h2>
        <script type="text/javascript">
            if (clipboardData && clipboardData.setData) document.write('<a class="button" onmouseover="this.style.color=&quot;#fff&quot;;this.style.background=&quot;#999&quot;; "onmouseout="this.style.color=&quot;#444&quot;;this.style.background=&quot;#E9E9E9&quot;; ToolTip.style.visibility=&quot;hidden&quot;"onclick="clipboardData.setData(&quot;Text&quot;, au3code.innerText);          ToolTip.innerHTML=&quot;<table><tr><td class=tooltip>Copied!&lt;/td>&lt;/tr>&lt;/table>&quot;;          ToolTip.style.pixelLeft=(event.x+20+document.body.scrollLeft);          ToolTip.style.pixelTop=(event.y+15+document.body.scrollTop);          ToolTip.style.visibility=&quot;visible&quot;;          setTimeout(&#39;ToolTip.style.visibility=&quot;hidden&quot;&#39;, 1200);">Copy to clipboard<\/a>');
        </script>
        <div id="ToolTip" class="tip"></div>
<p class="codebox" id="au3code"> 


<span class="S11">#include<span class="S7">&nbsp;"WinHttp.au3"</span></span><br><br>
<span class="S4">Opt</span><span class="S8">(</span><span class="S7">"MustDeclareVars"</span><span class="S8">,</span><span class="S3">&nbsp;1</span><span class="S8">)</span><br><br>
<span class="S2">; Initialize</span><br>
<span class="S5">Global</span><span class="S9">&nbsp;$hOpen</span><span class="S8">&nbsp;=</span><span class="S15">&nbsp;_WinHttpOpen</span><span class="S8">()</span><br><br>
<span class="S5">If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Error initializing the usage of WinHTTP functions."</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;Exit</span><span class="S3">&nbsp;1</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; Specify what to connect to</span><br>
<span class="S5">Global</span><span class="S9">&nbsp;$hConnect</span><span class="S8">&nbsp;=</span><span class="S15">&nbsp;_WinHttpConnect</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">,</span><span class="S7">&nbsp;"yahoo.com"</span><span class="S8">)</span><span class="S2">&nbsp;; <- yours here</span><br>
<span class="S5">If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Error specifying the initial target server of an HTTP request."</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;Exit</span><span class="S3">&nbsp;2</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; Create request</span><br>
<span class="S5">Global</span><span class="S9">&nbsp;$hRequest</span><span class="S8">&nbsp;=</span><span class="S15">&nbsp;_WinHttpOpenRequest</span><span class="S8">(</span><span class="S9">$hConnect</span><span class="S8">)</span><br>
<span class="S5">If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Error creating an HTTP request handle."</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hConnect</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;Exit</span><span class="S3">&nbsp;3</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; Send it</span><br>
<span class="S15">_WinHttpSendRequest</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S5">If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Error sending specified request."</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hConnect</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;Exit</span><span class="S3">&nbsp;4</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; Wait for the response</span><br>
<span class="S15">_WinHttpReceiveResponse</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S5">If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Error waiting for the response from the server."</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hConnect</span><span class="S8">)</span><br>
<span class="S15">&nbsp;&nbsp;&nbsp;&nbsp;_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;Exit</span><span class="S3">&nbsp;5</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; See if there is data to read</span><br>
<span class="S5">Global</span><span class="S9">&nbsp;$sChunk</span><span class="S8">,</span><span class="S9">&nbsp;$sData</span><br>
<span class="S5">If</span><span class="S15">&nbsp;_WinHttpQueryDataAvailable</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><span class="S5">&nbsp;Then</span><br>
<span class="S2">&nbsp;&nbsp;&nbsp;&nbsp;; Read</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;While</span><span class="S3">&nbsp;1</span><br>
<span class="S9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sChunk</span><span class="S8">&nbsp;=</span><span class="S15">&nbsp;_WinHttpReadData</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If</span><span class="S6">&nbsp;@error</span><span class="S5">&nbsp;Then ExitLoop</span><br>
<span class="S9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$sData</span><span class="S8">&nbsp;&=</span><span class="S9">&nbsp;$sChunk</span><br>
<span class="S5">&nbsp;&nbsp;&nbsp;&nbsp;WEnd</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;ConsoleWrite</span><span class="S8">(</span><span class="S9">$sData</span><span class="S8">&nbsp;&amp;</span><span class="S6">&nbsp;@CRLF</span><span class="S8">)</span><span class="S2">&nbsp;; print to console</span><br>
<span class="S5">Else</span><br>
<span class="S4">&nbsp;&nbsp;&nbsp;&nbsp;MsgBox</span><span class="S8">(</span><span class="S3">48</span><span class="S8">,</span><span class="S7">&nbsp;"Error"</span><span class="S8">,</span><span class="S7">&nbsp;"Site is experiencing problems."</span><span class="S8">)</span><br>
<span class="S5">EndIf</span><br><br>
<span class="S2">; Close handles when they are not needed any more</span><br>
<span class="S15">_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hRequest</span><span class="S8">)</span><br>
<span class="S15">_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hConnect</span><span class="S8">)</span><br>
<span class="S15">_WinHttpCloseHandle</span><span class="S8">(</span><span class="S9">$hOpen</span><span class="S8">)</span><br><br>
</p>
        <br>
        <p>&nbsp;</p>

<!--Footer Section-->
<hr style="height:0px">
        <p>WinHttp</p>
    </body>
</html>
